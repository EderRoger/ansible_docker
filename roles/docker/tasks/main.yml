- name: Creates directory
  file: path=/var/www/html/website state=directory
  tags:
    - index_file

- name: copy index file
  template: src=index.html.j2 dest=/var/www/html/website/index.html
  tags:
    - index_file

- name: syncronize dockerfile
  synchronize: src=../files dest=/tmp
  tags:
    - copy_file

- name: build the image
  docker_image: >
    name=built-by-ansible
    tag=nginx
    path=/tmp/files
    state=present
  tags:
    - image

- name: run the site in a docker container
  docker:
    name: nginx
    image: "built-by-ansible:nginx"
    state: reloaded
    restart_policy: always
    publish_all_ports: yes
    ports:
      80:80
  tags:
      - container_nginx
